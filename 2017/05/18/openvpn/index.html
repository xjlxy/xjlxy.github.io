<!DOCTYPE html>
<html lang="zh-Hans">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="http://dl.fedoraproject.org/pub/epel/6/x86_64/pkcs11-helper-1.11-3.el6.x86_64.rpm
install OpenVPNyumCentOS 5rpm -ivh http://apt.sw.be/redhat/el5/en/x8">
    

    <!--Author-->
    
        <meta name="author" content="John Doe">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="openvpn"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="XJL"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>openvpn - XJL</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <!-- favicon -->
    
	
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">.</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/xjlxy">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>openvpn</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        2017-05-18
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a href="/tags/vpn/">#vpn</a>


                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p><a href="http://dl.fedoraproject.org/pub/epel/6/x86_64/pkcs11-helper-1.11-3.el6.x86_64.rpm" target="_blank" rel="external">http://dl.fedoraproject.org/pub/epel/6/x86_64/pkcs11-helper-1.11-3.el6.x86_64.rpm</a></p>
<h2 id="install-OpenVPN"><a href="#install-OpenVPN" class="headerlink" title="install OpenVPN"></a>install OpenVPN</h2><h4 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h4><p>CentOS 5<br>rpm -ivh <a href="http://apt.sw.be/redhat/el5/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.2-2.el5.rf.x86_64.rpm" target="_blank" rel="external">http://apt.sw.be/redhat/el5/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.2-2.el5.rf.x86_64.rpm</a></p>
<p>CentOS 6<br>rpm -ivh <a href="http://apt.sw.be/redhat/el6/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm" target="_blank" rel="external">http://apt.sw.be/redhat/el6/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm</a></p>
<p>yum install -y openvpn</p>
<h3 id="make-source"><a href="#make-source" class="headerlink" title="make source"></a>make source</h3><p>wget -c <a href="https://swupdate.openvpn.org/community/releases/openvpn-2.4.1.tar.gz" target="_blank" rel="external">https://swupdate.openvpn.org/community/releases/openvpn-2.4.1.tar.gz</a><br>tar xf openvpn-2.4.1.tar.gz<br>./configure<br>make &amp;&amp; make install</p>
<h3 id="easy-rsa"><a href="#easy-rsa" class="headerlink" title="easy-rsa"></a>easy-rsa</h3><p>wget -O easy-rsa.zip <a href="https://github.com/OpenVPN/easy-rsa-old/archive/master.zip" target="_blank" rel="external">https://github.com/OpenVPN/easy-rsa-old/archive/master.zip</a></p>
<h2 id="vi-var"><a href="#vi-var" class="headerlink" title="vi var"></a>vi var</h2><p>KEY_COUNTRY：所在国家<br>KEY_PROVINCE：所在省<br>KEY_CITY：所在城市<br>KEY_ORG：所在组织<br>KEY_EMAIL：邮箱地址<br>KEY_OU：机构单位或部门名称</p>
<h2 id="create-CA"><a href="#create-CA" class="headerlink" title="create CA"></a>create CA</h2><p>cp -R /usr/share/doc/openvpn-<em>/easy-rsa /etc/openvpn<br>cd /etc/openvpn/easy-rsa/2.0<br>chmod +x </em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">. vars</div><div class="line">./clean-all</div><div class="line">./build-ca</div><div class="line">./build-key-server server</div><div class="line">./build-key client</div><div class="line">./build-dh</div><div class="line"></div><div class="line">openvpn --genkey --secret keys/ta.key</div></pre></td></tr></table></figure>
<p>ln -s $(readlink -f keys/) /etc/openvpn/config<br>cp /opt/openvpn-2.4.1/sample/sample-config-files/client.conf ./</p>
<p>ls /etc/openvpn/easy-rsa/2.*/keys/</p>
<h2 id="server-conf"><a href="#server-conf" class="headerlink" title="server.conf"></a>server.conf</h2><p>cp -a /usr/share/doc/openvpn-2.2.2/sample-config-files/server.conf /etc/openvpn/</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">port 1194</div><div class="line">proto udp</div><div class="line">dev tun</div><div class="line">ca ca.crt</div><div class="line">cert server.crt</div><div class="line">key server.key</div><div class="line">dh dh2048.pem</div><div class="line">server 10.8.0.0 255.255.255.0</div><div class="line"># 推送路由信息到客户端，以允许客户端能够连接到服务器背后的其他私有子网。</div><div class="line"># (简而言之，就是允许客户端访问VPN服务器自身所在的其他局域网)</div><div class="line"># 记住，这些私有子网也要将OpenVPN客户端的地址池(10.8.0.0/255.255.255.0)反馈回OpenVPN服务器。</div><div class="line">;push "route 192.168.10.0 255.255.255.0"</div><div class="line">;push "route 192.168.20.0 255.255.255.0"</div><div class="line"></div><div class="line"># 如果多个客户端可能使用相同的证书/私钥文件或Common Name进行连接，那么你可以取消该指令的注释。</div><div class="line"># 建议该指令仅用于测试目的。对于生产使用环境而言，每个客户端都应该拥有自己的证书和私钥。</div><div class="line"># 如果你没有为每个客户端分别生成Common Name唯一的证书/私钥，你可以取消该行的注释(但不推荐这样做)。</div><div class="line">duplicate-cn</div><div class="line"></div><div class="line">ifconfig-pool-persist ipp.txt</div><div class="line">keepalive 10 120</div><div class="line">tls-auth ta.key 0</div><div class="line">##</div><div class="line">cipher AES-256-CBC</div><div class="line">persist-key</div><div class="line">persist-tun</div><div class="line">status openvpn-status.log</div><div class="line">verb 3</div><div class="line">explicit-exit-notify 1</div></pre></td></tr></table></figure>
<h2 id="client-conf"><a href="#client-conf" class="headerlink" title="client.conf"></a>client.conf</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">client</div><div class="line">dev tun</div><div class="line">proto udp</div><div class="line">remote 172.16.90.136 1194</div><div class="line">resolv-retry infinite</div><div class="line">nobind</div><div class="line">persist-key</div><div class="line">persist-tun</div><div class="line">ca ca.crt</div><div class="line">cert xy.crt</div><div class="line">key xy.key</div><div class="line">remote-cert-tls server</div><div class="line">tls-auth ta.key 1</div><div class="line">cipher AES-256-CBC</div><div class="line">verb 3</div></pre></td></tr></table></figure>
<h2 id="detail"><a href="#detail" class="headerlink" title="detail"></a>detail</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div></pre></td><td class="code"><pre><div class="line">server.ovpn</div><div class="line">#################################################</div><div class="line"># 针对多客户端的OpenVPN 2.0 的服务器端配置文件示例</div><div class="line">#</div><div class="line"># 本文件用于多客户端&lt;-&gt;单服务器端的OpenVPN服务器端配置</div><div class="line">#</div><div class="line"># OpenVPN也支持单机&lt;-&gt;单机的配置(更多信息请查看网站上的示例页面)</div><div class="line">#</div><div class="line"># 该配置支持Windows或者Linux/BSD系统。此外，在Windows上，记得将路径加上双引号，</div><div class="line"># 并且使用两个反斜杠，例如："C:<span class="tag">\<span class="name">\</span></span>Program Files<span class="tag">\<span class="name">\</span></span>OpenVPN<span class="tag">\<span class="name">\</span></span>config<span class="tag">\<span class="name">\</span></span>foo.key"</div><div class="line">#</div><div class="line"># '#' or ';'开头的均为注释内容</div><div class="line">#################################################</div><div class="line"></div><div class="line">#OpenVPN应该监听本机的哪些IP地址？</div><div class="line">#该命令是可选的，如果不设置，则默认监听本机的所有IP地址。</div><div class="line">;local a.b.c.d</div><div class="line"></div><div class="line"># OpenVPN应该监听哪个TCP/UDP端口？</div><div class="line"># 如果你想在同一台计算机上运行多个OpenVPN实例，你可以使用不同的端口号来区分它们。</div><div class="line"># 此外，你需要在防火墙上开放这些端口。</div><div class="line">port 1194</div><div class="line"></div><div class="line">#OpenVPN使用TCP还是UDP协议?</div><div class="line">;proto tcp</div><div class="line">proto udp</div><div class="line"></div><div class="line"># 指定OpenVPN创建的通信隧道类型。</div><div class="line"># "dev tun"将会创建一个路由IP隧道，</div><div class="line"># "dev tap"将会创建一个以太网隧道。</div><div class="line">#</div><div class="line"># 如果你是以太网桥接模式，并且提前创建了一个名为"tap0"的与以太网接口进行桥接的虚拟接口，则你可以使用"dev tap0"</div><div class="line">#</div><div class="line"># 如果你想控制VPN的访问策略，你必须为TUN/TAP接口创建防火墙规则。</div><div class="line">#</div><div class="line"># 在非Windows系统中，你可以给出明确的单位编号(unit number)，例如"tun0"。</div><div class="line"># 在Windows中，你也可以使用"dev-node"。</div><div class="line"># 在多数系统中，除非你部分禁用或者完全禁用了TUN/TAP接口的防火墙，否则VPN将不起作用。</div><div class="line">;dev tap</div><div class="line">dev tun</div><div class="line"></div><div class="line"># 如果你想配置多个隧道，你需要用到网络连接面板中TAP-Win32适配器的名称(例如"MyTap")。</div><div class="line"># 在XP SP2或更高版本的系统中，你可能需要有选择地禁用掉针对TAP适配器的防火墙</div><div class="line"># 通常情况下，非Windows系统则不需要该指令。</div><div class="line">;dev-node MyTap</div><div class="line"></div><div class="line"># 设置SSL/TLS根证书(ca)、证书(cert)和私钥(key)。</div><div class="line"># 每个客户端和服务器端都需要它们各自的证书和私钥文件。</div><div class="line"># 服务器端和所有的客户端都将使用相同的CA证书文件。</div><div class="line">#</div><div class="line"># 通过easy-rsa目录下的一系列脚本可以生成所需的证书和私钥。</div><div class="line"># 记住，服务器端和每个客户端的证书必须使用唯一的Common Name。</div><div class="line">#</div><div class="line"># 你也可以使用遵循X509标准的任何密钥管理系统来生成证书和私钥。</div><div class="line"># OpenVPN 也支持使用一个PKCS #12格式的密钥文件(详情查看站点手册页面的"pkcs12"指令)</div><div class="line">ca ca.crt</div><div class="line">cert server.crt</div><div class="line">key server.key # 该文件应该保密</div><div class="line"></div><div class="line"># 指定迪菲·赫尔曼参数。</div><div class="line"># 你可以使用如下名称命令生成你的参数：</div><div class="line"># openssl dhparam -out dh1024.pem 1024</div><div class="line"># 如果你使用的是2048位密钥，使用2048替换其中的1024。</div><div class="line">dh dh1024.pem</div><div class="line"></div><div class="line"># 设置服务器端模式，并提供一个VPN子网，以便于从中为客户端分配IP地址。</div><div class="line"># 在此处的示例中，服务器端自身将占用10.8.0.1，其他的将提供客户端使用。</div><div class="line"># 如果你使用的是以太网桥接模式，请注释掉该行。更多信息请查看官方手册页面。</div><div class="line">server 10.8.0.0 255.255.255.0</div><div class="line"></div><div class="line"># 指定用于记录客户端和虚拟IP地址的关联关系的文件。</div><div class="line"># 当重启OpenVPN时，再次连接的客户端将分配到与上一次分配相同的虚拟IP地址</div><div class="line">ifconfig-pool-persist ipp.txt</div><div class="line"></div><div class="line"># 该指令仅针对以太网桥接模式。</div><div class="line"># 首先，你必须使用操作系统的桥接能力将以太网网卡接口和TAP接口进行桥接。</div><div class="line"># 然后，你需要手动设置桥接接口的IP地址、子网掩码；</div><div class="line"># 在这里，我们假设为10.8.0.4和255.255.255.0。</div><div class="line"># 最后，我们必须指定子网的一个IP范围(例如从10.8.0.50开始，到10.8.0.100结束)，以便于分配给连接的客户端。</div><div class="line"># 如果你不是以太网桥接模式，直接注释掉这行指令即可。</div><div class="line">;server-bridge 10.8.0.4 255.255.255.0 10.8.0.50 10.8.0.100</div><div class="line"></div><div class="line"># 该指令仅针对使用DHCP代理的以太网桥接模式，</div><div class="line"># 此时客户端将请求服务器端的DHCP服务器，从而获得分配给它的IP地址和DNS服务器地址。</div><div class="line">#</div><div class="line"># 在此之前，你也需要先将以太网网卡接口和TAP接口进行桥接。</div><div class="line"># 注意：该指令仅用于OpenVPN客户端，并且该客户端的TAP适配器需要绑定到一个DHCP客户端上。</div><div class="line">;server-bridge</div><div class="line"></div><div class="line"># 推送路由信息到客户端，以允许客户端能够连接到服务器背后的其他私有子网。</div><div class="line"># (简而言之，就是允许客户端访问VPN服务器自身所在的其他局域网)</div><div class="line"># 记住，这些私有子网也要将OpenVPN客户端的地址池(10.8.0.0/255.255.255.0)反馈回OpenVPN服务器。</div><div class="line">;push "route 192.168.10.0 255.255.255.0"</div><div class="line">;push "route 192.168.20.0 255.255.255.0"</div><div class="line"></div><div class="line"># 为指定的客户端分配指定的IP地址，或者客户端背后也有一个私有子网想要访问VPN，</div><div class="line"># 那么你可以针对该客户端的配置文件使用ccd子目录。</div><div class="line"># (简而言之，就是允许客户端所在的局域网成员也能够访问VPN)</div><div class="line"></div><div class="line"># 举个例子：假设有个Common Name为"Thelonious"的客户端背后也有一个小型子网想要连接到VPN，该子网为192.168.40.128/255.255.255.248。</div><div class="line"># 首先，你需要去掉下面两行指令的注释：</div><div class="line">;client-config-dir ccd</div><div class="line">;route 192.168.40.128 255.255.255.248</div><div class="line"># 然后创建一个文件ccd/Thelonious，该文件的内容为：</div><div class="line"># iroute 192.168.40.128 255.255.255.248</div><div class="line">#这样客户端所在的局域网就可以访问VPN了。</div><div class="line"># 注意，这个指令只能在你是基于路由、而不是基于桥接的模式下才能生效。</div><div class="line"># 比如，你使用了"dev tun"和"server"指令。</div><div class="line"></div><div class="line"># 再举个例子：假设你想给Thelonious分配一个固定的IP地址10.9.0.1。</div><div class="line"># 首先，你需要去掉下面两行指令的注释：</div><div class="line">;client-config-dir ccd</div><div class="line">;route 10.9.0.0 255.255.255.252</div><div class="line"># 然后在文件ccd/Thelonious中添加如下指令：</div><div class="line"># ifconfig-push 10.9.0.1 10.9.0.2</div><div class="line"></div><div class="line"># 如果你想要为不同群组的客户端启用不同的防火墙访问策略，你可以使用如下两种方法：</div><div class="line"># (1)运行多个OpenVPN守护进程，每个进程对应一个群组，并为每个进程(群组)启用适当的防火墙规则。</div><div class="line"># (2) (进阶)创建一个脚本来动态地修改响应于来自不同客户的防火墙规则。</div><div class="line"># 关于learn-address脚本的更多信息请参考官方手册页面。</div><div class="line">;learn-address ./script</div><div class="line"></div><div class="line"># 如果启用该指令，所有客户端的默认网关都将重定向到VPN，这将导致诸如web浏览器、DNS查询等所有客户端流量都经过VPN。</div><div class="line"># (为确保能正常工作，OpenVPN服务器所在计算机可能需要在TUN/TAP接口与以太网之间使用NAT或桥接技术进行连接)</div><div class="line">;push "redirect-gateway def1 bypass-dhcp"</div><div class="line"></div><div class="line"># 某些具体的Windows网络设置可以被推送到客户端，例如DNS或WINS服务器地址。</div><div class="line"># 下列地址来自opendns.com提供的Public DNS 服务器。</div><div class="line">;push "dhcp-option DNS 208.67.222.222"</div><div class="line">;push "dhcp-option DNS 208.67.220.220"</div><div class="line"></div><div class="line"># 去掉该指令的注释将允许不同的客户端之间相互"可见"(允许客户端之间互相访问)。</div><div class="line"># 默认情况下，客户端只能"看见"服务器。为了确保客户端只能看见服务器，你还可以在服务器端的TUN/TAP接口上设置适当的防火墙规则。</div><div class="line">;client-to-client</div><div class="line"></div><div class="line"># 如果多个客户端可能使用相同的证书/私钥文件或Common Name进行连接，那么你可以取消该指令的注释。</div><div class="line"># 建议该指令仅用于测试目的。对于生产使用环境而言，每个客户端都应该拥有自己的证书和私钥。</div><div class="line"># 如果你没有为每个客户端分别生成Common Name唯一的证书/私钥，你可以取消该行的注释(但不推荐这样做)。</div><div class="line">;duplicate-cn</div><div class="line"></div><div class="line"># keepalive指令将导致类似于ping命令的消息被来回发送，以便于服务器端和客户端知道对方何时被关闭。</div><div class="line"># 每10秒钟ping一次，如果120秒内都没有收到对方的回复，则表示远程连接已经关闭。</div><div class="line">keepalive 10 120</div><div class="line"></div><div class="line"># 出于SSL/TLS之外更多的安全考虑，创建一个"HMAC 防火墙"可以帮助抵御DoS攻击和UDP端口淹没攻击。</div><div class="line"># 你可以使用以下命令来生成：</div><div class="line"># openvpn --genkey --secret ta.key</div><div class="line">#</div><div class="line"># 服务器和每个客户端都需要拥有该密钥的一个拷贝。</div><div class="line"># 第二个参数在服务器端应该为'0'，在客户端应该为'1'。</div><div class="line">;tls-auth ta.key 0 # 该文件应该保密</div><div class="line"></div><div class="line"># 选择一个密码加密算法。</div><div class="line"># 该配置项也必须复制到每个客户端配置文件中。</div><div class="line">;cipher BF-CBC # Blowfish (默认)</div><div class="line">;cipher AES-128-CBC # AES</div><div class="line">;cipher DES-EDE3-CBC # Triple-DES</div><div class="line"></div><div class="line"># 在VPN连接上启用压缩。</div><div class="line"># 如果你在此处启用了该指令，那么也应该在每个客户端配置文件中启用它。</div><div class="line">comp-lzo</div><div class="line"></div><div class="line"># 允许并发连接的客户端的最大数量</div><div class="line">;max-clients 100</div><div class="line"></div><div class="line"># 在完成初始化工作之后，降低OpenVPN守护进程的权限是个不错的主意。</div><div class="line"># 该指令仅限于非Windows系统中使用。</div><div class="line">;user nobody</div><div class="line">;group nobody</div><div class="line"></div><div class="line"># 持久化选项可以尽量避免访问那些在重启之后由于用户权限降低而无法访问的某些资源。</div><div class="line">persist-key</div><div class="line">persist-tun</div><div class="line"></div><div class="line"># 输出一个简短的状态文件，用于显示当前的连接状态，该文件每分钟都会清空并重写一次。</div><div class="line">status openvpn-status.log</div><div class="line"></div><div class="line"># 默认情况下，日志消息将写入syslog(在Windows系统中，如果以服务方式运行，日志消息将写入OpenVPN安装目录的log文件夹中)。</div><div class="line"># 你可以使用log或者log-append来改变这种默认情况。</div><div class="line"># "log"方式在每次启动时都会清空之前的日志文件。</div><div class="line"># "log-append"这是在之前的日志内容后进行追加。</div><div class="line"># 你可以使用两种方式之一(但不要同时使用)。</div><div class="line">;log openvpn.log</div><div class="line">;log-append openvpn.log</div><div class="line"></div><div class="line"># 为日志文件设置适当的冗余级别(0~9)。冗余级别越高，输出的信息越详细。</div><div class="line">#</div><div class="line"># 0 表示静默运行，只记录致命错误。</div><div class="line"># 4 表示合理的常规用法。</div><div class="line"># 5 和 6 可以帮助调试连接错误。</div><div class="line"># 9 表示极度冗余，输出非常详细的日志信息。</div><div class="line">verb 3</div><div class="line"></div><div class="line"># 重复信息的沉默度。</div><div class="line"># 相同类别的信息只有前20条会输出到日志文件中。</div><div class="line">;mute 20</div></pre></td></tr></table></figure>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line">##############################################</div><div class="line"># 针对多个客户端的OpenVPN 2.0 的客户端配置文件示例</div><div class="line">#</div><div class="line"># 该配置文件可以被多个客户端使用，当然每个客户端都应该有自己的证书和密钥文件</div><div class="line">#</div><div class="line"># 在Windows上此配置文件的后缀应该是".ovpn"，在Linux/BSD系统中则是".conf"</div><div class="line">##############################################</div><div class="line"></div><div class="line"># 指定这是一个客户端，我们将从服务器获取某些配置文件指令</div><div class="line">client</div><div class="line"></div><div class="line"># 在大多数系统中，除非你部分禁用或者完全禁用了TUN/TAP接口的防火墙，否则VPN将不起作用。</div><div class="line">;dev tap</div><div class="line">dev tun</div><div class="line"></div><div class="line"># 在Windows系统中，如果你想配置多个隧道，则需要该指令。</div><div class="line"># 你需要用到网络连接面板中TAP-Win32适配器的名称(例如"MyTap")。</div><div class="line"># 在XP SP2或更高版本的系统中，你可能需要禁用掉针对TAP适配器的防火墙。</div><div class="line">;dev-node MyTap</div><div class="line"></div><div class="line"># 指定连接的服务器是采用TCP还是UDP协议。</div><div class="line"># 这里需要使用与服务器端相同的设置。</div><div class="line">;proto tcp</div><div class="line">proto udp</div><div class="line"></div><div class="line"># 指定服务器的主机名(或IP)以及端口号。</div><div class="line"># 如果有多个VPN服务器，为了实现负载均衡，你可以设置多个remote指令。</div><div class="line">remote my-server-1 1194</div><div class="line">;remote my-server-2 1194</div><div class="line"></div><div class="line"># 如果指定了多个remote指令，启用该指令将随机连接其中的一台服务器，</div><div class="line"># 否则，客户端将按照指定的先后顺序依次尝试连接服务器。</div><div class="line">;remote-random</div><div class="line"></div><div class="line"># 启用该指令，与服务器连接中断后将自动重新连接，这在网络不稳定的情况下(例如：笔记本电脑无线网络)非常有用。</div><div class="line">resolv-retry infinite</div><div class="line"></div><div class="line"># 大多数客户端不需要绑定本机特定的端口号</div><div class="line">nobind</div><div class="line"></div><div class="line"># 在初始化完毕后，降低OpenVPN的权限(该指令仅限于非Windows系统中使用)</div><div class="line">;user nobody</div><div class="line">;group nobody</div><div class="line"></div><div class="line"># 持久化选项可以尽量避免访问在重启时由于用户权限降低而无法访问的某些资源。</div><div class="line">persist-key</div><div class="line">persist-tun</div><div class="line"></div><div class="line"># 如果你是通过HTTP代理方式来连接到实际的VPN服务器，请在此处指定代理服务器的主机名(或IP)和端口号。</div><div class="line"># 如果你的代理服务器需要身份认证，请参考官方手册页面。</div><div class="line">;http-proxy-retry # 连接失败时自动重试</div><div class="line">;http-proxy [proxy server] [proxy port #]</div><div class="line"></div><div class="line"># 无线网络通常会产生大量的重复数据包。设置此标识将忽略掉重复数据包的警告信息。</div><div class="line">;mute-replay-warnings</div><div class="line"></div><div class="line"># SSL/TLS 参数配置。</div><div class="line"># 更多描述信息请参考服务器端配置文件。</div><div class="line"># 最好为每个客户端单独分配.crt/.key文件对。</div><div class="line"># 单个CA证书可以供所有客户端使用。</div><div class="line">ca ca.crt</div><div class="line">cert client.crt</div><div class="line">key client.key</div><div class="line"></div><div class="line"># 指定通过检查证书的nsCertType字段是否为"server"来验证服务器端证书。</div><div class="line"># 这是预防潜在攻击的一种重要措施。</div><div class="line">#</div><div class="line"># 为了使用该功能，你需要在生成服务器端证书时，将其中的nsCertType字段设为"server"</div><div class="line"># easy-rsa文件夹中的build-key-server脚本文件可以达到该目的。</div><div class="line">ns-cert-type server</div><div class="line"></div><div class="line"># 如果服务器端使用了tls-auth密钥，那么每个客户端也都应该有该密钥。</div><div class="line">;tls-auth ta.key 1</div><div class="line"></div><div class="line"># 指定密码的加密算法。</div><div class="line"># 如果服务器端启用了cipher指令选项，那么你必须也在这里指定它。</div><div class="line">;cipher x</div><div class="line"></div><div class="line"># 在VPN连接中启用压缩。</div><div class="line"># 该指令的启用/禁用应该与服务器端保持一致。</div><div class="line">comp-lzo</div><div class="line"></div><div class="line"># 设置日志文件冗余级别(0~9)。</div><div class="line"># 0 表示静默运行，只记录致命错误。</div><div class="line"># 4 表示合理的常规用法。</div><div class="line"># 5 和 6 可以帮助调试连接错误。</div><div class="line"># 9 表示极度冗余，输出非常详细的日志信息。</div><div class="line">verb 3</div><div class="line"></div><div class="line"># 忽略过多的重复信息。</div><div class="line"># 相同类别的信息只有前20条会输出到日志文件中。</div><div class="line">;mute 20</div></pre></td></tr></table></figure>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    

                    

                    
                        <li>
                            <a href="mailto:xjljob@qq.com" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2019 John Doe<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>